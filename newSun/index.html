<!DOCTYPE html>
<html lang="en">
  <head>
    <title>three.js webgl - shaders - sky sun shader</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0" />
    <link type="text/css" rel="stylesheet" href="main.css" />
  </head>
  <body>
    <script src="./sky.js" type="module"></script>

    <script>
      const noise = `
    float N21 (vec2 st) { // https://thebookofshaders.com/10/
        return fract( sin( dot( st.xy, vec2(12.9898,78.233 ) ) ) *  43758.5453123);
    }
    
    float smoothNoise( vec2 ip ){ // https://www.youtube.com/watch?v=zXsWftRdsvU
      
    	vec2 lv = fract( ip );
      vec2 id = floor( ip );
      
      lv = lv * lv * ( 3. - 2. * lv );
      
      float bl = N21( id );
      float br = N21( id + vec2( 1, 0 ));
      float b = mix( bl, br, lv.x );
      
      float tl = N21( id + vec2( 0, 1 ));
      float tr = N21( id + vec2( 1, 1 ));
      float t = mix( tl, tr, lv.x );

      return (mix( b, t, lv.y ) + 1.) / 2.;
    }
    
    float smoothNoise2(vec2 p){
      
      p = ((vec2(-25., 25.) - p) / 50.); 
      p.y -= time / 50.;
      p *= 10.;
    
      float n = pow(smoothNoise(p), 4.01) * 1.25;
      n += smoothNoise(p * 2.34) * 0.25;
      n += smoothNoise(p * 4.56) * 0.125;
      n += smoothNoise(p * 8.13) * 0.0625;
      n /= (1.25 + 0.25 + 0.125 + 0.0625);
      return n;
    }
    
    vec3 getNormal(vec2 p, float n0){
      vec2 e = vec2(1e-2, 0.);
      vec3 v0 = vec3(p.x, n0, p.y);
      vec2 e1 = p + e.xy;
      vec3 v1 = vec3(e1.x, smoothNoise2(e1), e1.y);
      vec2 e2 = p + e.yx;
      vec3 v2 = vec3(e2.x, smoothNoise2(e2), e2.y);
      
      vec3 n = cross(v2 - v0, v1 - v0);
      
      return normalize(n);
    }
  `;
    </script>

    <script src="./mountains.js" type="module"></script>
  </body>
</html>
